<script>
  // Base chính là URL /exec mà bạn đang mở
  const API_BASE = 'https://script.google.com/macros/s/AKfycbxMaxUjgyrcdBblellGjf7KaRQUmCrR_DmF5bAchA8kWdrTk2_zHR2wNtfC8WZpqJS4/exec'

  async function findStudent(){
    const msv = (document.getElementById('msvInput').value || '').trim();
    const statusEl = document.getElementById('status');
    if(!msv){ statusEl.textContent = 'Nhập MSSV để tra cứu.'; renderRow(null); return; }

    statusEl.textContent = 'Đang tra cứu...';
    try{
      const t = Math.random().toString(36).slice(2);
      const url = `${API_BASE}?api=lookup&msv=${encodeURIComponent(msv)}&t=${encodeURIComponent(t)}`;

      const res = await fetch(url, { method: 'GET', cache: 'no-store' });
      const ct = (res.headers.get('content-type') || '').toLowerCase();
      if (!ct.includes('application/json')) {
        throw new Error('API trả về HTML (có thể bạn đang mở sai URL hoặc đang dùng GitHub Pages).');
      }

      const data = await res.json();
      if(!data.ok){ statusEl.textContent = data.error || 'Lỗi tra cứu'; renderRow(null); return; }

      statusEl.textContent = data.found ? 'Đã tìm thấy 1 kết quả.' : 'Không tìm thấy kết quả.';
      renderRow(data.data);
    } catch(err) {
      statusEl.textContent = 'Lỗi: ' + err.message;
      renderRow(null);
    }
  }
</script>
